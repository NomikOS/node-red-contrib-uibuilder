"use strict";if("undefined"!=typeof require&&void 0===io)var io=require("socket.io-client");(function(){var e=this,t=e.uibuilder,n=function(){var e=this;return e.version="1.0.7",e.debug=!1,e.uiDebug=function(t,n){if(e.debug){switch(this.myLog={},t){case"error":this.myLog=console.error;break;case"warn":this.myLog=console.warn;break;case"info":this.myLog=console.info;break;case"dir":this.myLog=console.dir;break;default:this.myLog=console.log}this.myLog(n)}},e.me=function(){return!0===e.debug?e:"uibuilderfe.js Version: "+e.version},e.setIOnamespace=function(){var t="";if(""===(t=document.cookie.replace(/(?:(?:^|.*;\s*)uibuilder-namespace\s*\=\s*([^;]*?).*$)|^.*$/,"$1"))){var n=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});n[n.length-1].endsWith(".html")&&n.pop(),t=n.join("/")}return t="/"+t,e.uiDebug("log","uibuilderfe: IO Namespace: "+t),t},e.autoSendReady=!0,e.allowScript=!0,e.allowStyle=!0,e.removeScript=!0,e.removeStyle=!0,e.msg={},e.ctrlMsg={},e.sentMsg={},e.msgsSent=0,e.msgsReceived=0,e.msgsSentCtrl=0,e.msgsCtrl=0,e.ioConnected=!1,e.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},e.retryMs=2e3,e.retryFactor=1.5,e.timerid=null,e.ioNamespace=e.setIOnamespace(),e.ioPath="/uibuilder/socket.io",e.ioTransport=["polling","websocket"],e.set=function(t,n){e[t]=n,e.uiDebug("log","uibuilderfe: prop set - prop: "+t+", val: "+("object"==typeof n)?JSON.stringify(n):n),e.emit(t,n)},e.socket=io(e.ioNamespace,{path:e.ioPath,transports:e.ioTransport,query:"auth_token="+e.auth_token}),e.checkConnect=function(t,n){var o=o++||1;e.uiDebug("log","checkConnect. Depth: ",o," , Delay: ",t,", Factor: ",n),e.timerid&&window.clearTimeout(e.timerid),e.timerid=window.setTimeout(function(){e.uiDebug("log","checkConnect timeout. SIO reconnect attempt, timeout: "+t+", depth: "+o),e.socket.close(),e.socket.connect(),e.timerid=null,e.checkConnect(t*n,n)},t)},e.socket.on("connect",function(){e.uiDebug("log","uibuilderfe: SOCKET CONNECTED - Namespace: "+e.ioNamespace),e.set("ioConnected",!0),e.timerid&&(window.clearTimeout(e.timerid),e.timerid=null)}),e.socket.on(e.ioChannels.server,function(t){e.uiDebug("info","uibuilderfe: socket.on.server - msg received - Namespace: "+e.ioNamespace),e.uiDebug("dir",t),t=o(t,"payload"),e.allowScript&&t.hasOwnProperty("script")&&(e.newScript(t.script),e.removeScript&&delete t.script),e.allowStyle&&t.hasOwnProperty("style")&&(e.newStyle(t.style),e.removeStyle&&delete t.style),e.set("msg",t),e.set("msgsReceived",e.msgsReceived+1)}),e.socket.on(e.ioChannels.control,function(t){e.uiDebug("info","uibuilder:socket.on.control - msg received - Namespace: "+e.ioNamespace),e.uiDebug("dir",t),null===t?t={}:"object"!=typeof t&&(t={uibuilderCtrl:t}),t.hasOwnProperty("debug")&&(e.debug=t.debug),e.set("ctrlMsg",t),e.set("msgsCtrl",e.msgsCtrl+1)}),e.socket.on("disconnect",function(t){e.uiDebug("log","SOCKET DISCONNECTED - Namespace: "+e.ioNamespace+", Reason: "+t),e.set("ioConnected",!1),"io server disconnect"===t&&e.checkConnect(e.retryMs,e.retryFactor)}),e.send=function(t,n){null!==n&&void 0!==n||(n=e.ioChannels.client),e.uiDebug("info","uibuilderfe: msg sent - Namespace: "+e.ioNamespace+", Channel: "+n),e.uiDebug("dir",t),n===e.ioChannels.client?t=o(t,"payload"):n===e.ioChannels.control&&((t=o(t,"uibuilderCtrl")).hasOwnProperty("uibuilderCtrl")||(t.uibuilderCtrl="manual send"),t.from="client"),e.set("sentMsg",t),n===e.ioChannels.client?e.set("msgsSent",e.msgsSent+1):n===e.ioChannels.control&&e.set("msgsCtrl",e.msgsCtrl+1),e.socket.emit(n,t)},e.events={},e.events.auth_token=function(){e.socket.query="auth_token="+e.auth_token,e.socket.io.opts.query="auth_token="+e.auth_token},e.emit=function(t){var n=e.events[t];if(n)for(var o=Array.prototype.slice.call(arguments,1),i=0;i<n.length;i++)n[i].apply(e,o)},e.newScript=function(t){if(!0===e.allowScript&&""!==t&&void 0!==t){e.uiDebug("log","uibuilderfe: newCode - script: "+t);var n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.textContent=t,document.getElementsByTagName("body")[0].appendChild(n)}},e.newStyle=function(t){if(!0===e.allowStyle&&""!==t&&void 0!==t){e.uiDebug("log","uibuilderfe: newStyle - style: "+t);var n=document.createElement("style");n.textContent=t,document.getElementsByTagName("head")[0].appendChild(n)}},e.uiReturn={set:function(t,n){-1===["version","debug","msg","ctrlMsg","sentMsg","msgsSent","msgsSentCtrl","msgsReceived","msgsCtrl","ioConnected","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","events","autoSendReady","set","get","send","sendCtrl","onChange","socket","checkConnect","emit","uiReturn","newScript","newStyle","uiDebug","me","self","setIOnamespace"].indexOf(t)?e.set(t,n):e.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+t+'" is in list of excluded properties, not set')},get:function(t){return e[t]},onChange:function(t,n){e.events[t]?e.events[t].push(n):e.events[t]=[n]},msg:e.msg,send:e.send,sendCtrl:function(t){e.send(t,e.ioChannels.control)},autoSendReady:function(t){!0!==t&&(t=!1),e.autoSendReady=t},debug:function(t){if(void 0===t)return e.debug;"boolean"==typeof t&&(e.debug=t)},uiDebug:e.uiDebug,me:e.me},window.addEventListener("load",function(){!0===e.autoSendReady&&e.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},e.ioChannels.control)}),e.checkConnect(e.retryMs,e.retryFactor),e.uiReturn}.call(e);n.noConflict=function(){return e.uibuilder=t,n},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.uibuilder=n):e.uibuilder=n;function o(e,t){null!==t&&void 0!==t||(t="payload"),"string"!=typeof t&&(console.warn("makeMeAnObject:WARNING: property parameter must be a string and not: "+typeof t),t="payload");var n={};return"object"==typeof e?n=e:null!==e&&(n[t]=e),n}}).call(this);